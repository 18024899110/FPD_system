0.前言
本系统是一款基于OpenCV的人脸识别门禁系统。系统主要采用python语言编写，总体结构设计上采用C/S模式，客户端与服务器之间通过socket进行通信。人机交互部分采用Pyqt5编写，以桌面应用程序的形式编写。服务器采用Pymysql操控Mysql数据库
1.系统需求分析
在系统的需求分析阶段，本系统采用的是线下约谈和线上采访两种方式，通过对本市的各大小区的物业人员以及户主的采访，收集到与物业门禁系统运作的有关信息以及基本结构，并且根据被采访者的建议以及需求对本系统进行了更合理更人性化的改动
2.相关技术
本系统主要使用了以下几种技术：
(1)Python
Python是跨平台的一种高级计算机应用程序设计语言，正式发行于1991年，拥有丰富、强大的文件库支持，可以满足多种
编程设计语言的模块化文件信息提取和联接。
(2)OpenCV
OpenCV 作为一个开源的计算机视觉库，能够跨平台，运行在多种不同的操作系统上，实现了很多计算机视觉、图像处理等方面的算法，能够对不同的物体和场景进行检测， 比如说人脸识别、车牌识别、交通标志识别以及行为姿势表 情识别等。
(3)Pyqt5
本FPD人脸识别门禁系统的人机交互部分采用的是桌面应用程序的形式。而本程序主要使用的是pyqt作为编写桌面应用程序的主要方式。此外还配套的又qt-designer 作为可视化ui创建辅助工具。使使用者能够更加准确的创建自己的桌面应用程序。
(4)Mysql
本系统主要使用Mysql作为数据库存储数据。Mysql通过表格的形式存储数据，使数据的存储与使用变得更为灵活。此外Mysql所使用的sql语言为标准sql语言，体积小，速度快，且社区版免费开源，是本系统选择mysql作为数据库的主要原因。
3.系统设计
人脸识别功能是本系统的核心。主要分为三个步骤，人脸录入与人脸检测，人脸训练和人脸识别。
人脸检测采用的是基于Haar特征的级联分类器算法。该算法是基于Haar-like特征，通过积分图进行加速的一种获取图片总体特征分布的算法。该算法通过将图片划分为不同的几个区域，将每一个区域的白色区域的像素值减去黑色区域的像素值得到该区域的特征值。在有积分图进行加速的情况下通过一次扫描就可以获取该图片所有划分的区域的特征值。这就是Haar特征。Haar特征是一种描述灰度变化的特征，在检测人脸方面效果尤为明显。因此本系统选择采用基于Haar特征的级联分类器算法来对摄像头所获取的图片进行人脸检测。
人脸训练与人脸识别所采用的都是LBP算法。LBP又称局部二值模式，主要是用于描述局部纹理特征。相较于传统Haar-like算法下的人脸识别，基于LBPS算法下的人脸识别拥有旋转不变性和灰度不变性的特点，不同于像传统Haar-like算法下的人脸识别那样对识别者的人脸位置，大小，光源有着严格的要求，LBP算法下的人脸识别拥有更灵活的应用场景，尤其是在某些光源过亮或过暗的场景更能展示出优势。此外,LBP还具有计算简单，计算效果好，数据量小等优点。
4.系统功能实现
本系统采用C/S模式进行设计。其中客户端分为两个，一个是安装在门禁处的人脸识别门禁客户端，另一个则是按照在用户自己的电脑上的，主要用于管理的用户管理客户端。
4.1人脸识别门禁客户端
该客户端主要有三个功能：人脸识别门禁，输入门禁密码，发送进入请求。
4.1.1人脸识别门禁
来访者点击打开摄像头，系统会调用摄像头并持续捕获画面，同时将每一帧的图片传送至服务器。服务器对图片进行处理，用Haar级联分类器对图片中的人脸进行检测，将检测出的人脸放入人脸识别模型中进行识别。人脸识别模型会返回一个信任分数与id，若是id非空且信任分数小于60则可以判断识别成功，返回识别成功信号给门禁客户端，门禁客户端开启门禁。若是识别失败则返回失败信号给门禁客户端，门禁客户端选择拒绝开启门禁。
4.1.2输入门禁密码
来访者选择输入门禁密码，系统将门禁密码发送至服务器，服务器将接受的密码与和数据库中的密码比对，若成功则返回成功信号给门禁客户端，门禁开启。若失败则返回失败信号给门禁客户端，门禁保持关闭
4.1.3输入来访请求
系统拍摄来访者的一张照片，来访者选择输入要访问的门牌号，系统将来访者照片与门牌号一起发送到服务器中。服务器将来访者人脸暂存于本地并调用邮件发送模块向该门牌号的户主发送提醒邮件且持续等待户主登入门禁客户端进行处理
4.2用户管理客户端
用户管理客户端提供了注册和登录功能。在注册时若输入了管理员密钥则可注册身份为管理员的用户，若不输入管理员密钥则默认为普通用户。用户管理客户端会根据用户的权限分为两个不同的页面，一个是普通住户页面，有人脸录入，处理进入请求和查看自家未成年人进出记录的功能。另一个是管理员专用页面，有管理用户信息功能，修改门禁密码和管理员密钥功能和管理住户人脸录入数据功能。
4.2.1处理进入请求
户主在收到提示邮件后登录用户管理客户端，点击处理进入请求，服务器会将来访者的来访请求信息和相应的照片发送给户主。户主可查看该照片并判断是否允许进入。若允许，服务器会向门禁客户端发送允许信号，门禁客户端接收到信号以后开启门禁。若失败，服务器会向门禁客户端发送拒绝信号，门禁客户端接受到信号后仍然保持门禁关闭状态。
4.2.2录入人脸
住户点击录入人脸功能，系统调用摄像头并拍摄十张人脸照片上传至服务器，服务器将这些人脸照片与相应的id一起添加到人脸训练模型进行训练。
4.2.3查看自家未成年人进入记录
未成年人人进出小区门禁时，门禁系统会向服务器发送进入信息，服务器会将这些进出信息存储至数据库。住户在登录用户管理客户端的时候可以点击查看自家未成年人进出记录来查看自家未成年人的进出时间，姓名等信息。
4.2.4管理用户数据
此功能为管理员专属功能。管理员点击管理用户数据，可以查看所有用户的账号，密码，姓名，年龄，住址，邮箱，性别，权限等信息，并对这些信息进行修改，增加，也可以输入指定条件查询
4.2.5管理门禁密码与管理员密钥
此功能为管理员专属功能。管理员点击管理门禁密码和管理员密钥。服务器会返回当前的管理员密钥与门禁密码给用户管理客户端。管理员可以选择对这些密码进行修改
4.2.6管理人脸录入数据功能
此功能为管理员专属功能。管理员可以查看所有住户的人脸录入情况。若已录入人脸则显示人脸录入情况为True，若没录入人脸则显示人脸录入情况为False。管理员可选中其中一位用户，点击删除人脸，服务器就会将该人脸数据从服务器本地删除，并重新再次训练一次人脸模型。
5.系统测试
针对人脸识别相关操作进行了一系列的测试。测试结果如图5.1所示：
动作	实际响应	是否正确
人脸录入	人脸成功添加至人脸模型中	是
人脸检测	成功检测出人脸并绘制矩形	是
人脸识别	成功将人脸和	是
图5.1 测试结果
6.总结
本系统在系统总体设计上采用了C/S的设计模式，即客户端与服务器相分离的设计模式。这么做的目的一是为了保证数据库数据的安全性，使用者无法直接访问数据库，而是需要通过客户端来向服务器间接的操作数据库，提高了系统的安全性。二是增强了代码的可维护性，客户端与服务器不会相互依赖。
在本系统的核心部分——人脸识别模块中，本系统采用的是基于LBP算子下的人脸识别。选择LBP算子的目的是为了提高人脸识别的多场景适用性，避免在某些特殊环境或特殊天气的情况下用户出现人脸识别失败的状况，提高了用户的使用体验。
本系统在安全保护方面上采用了邮箱验证码的形式，用户在注册的时候需要输入自己的邮箱，系统会向该邮箱发送验证码，用户需要输入正确的邮箱验证码来完成验证。此外在服务器设计中的与数据库交互的部分采用的是提前构造好参数列表来对sql语句进行传参的方式，这样做可以防止sql注入危险。
